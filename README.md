# 优先级调度

## 增加优先级属性

1. 在proc.h中修改结构体，增加priority属性![image-20220602073015761](./imgs/image-20220602073015761.png)
2. 在proc.c中修改allocproc函数，设置默认优先级![image-20220602073114876](/./imgs/image-20220602073114876.png)
3. 修改procdump函数，以便观察进程优先级![image-20220602073224213](./imgs/image-20220602073224213.png)

## 设置优先级

1. 在syscall.h中定义新系统调用![image-20220602073320647](./imgs/image-20220602073320647.png)
2. 在user.h中添加原型函数![image-20220602073342799](./imgs/image-20220602073342799.png)
3. 在usys.S添加汇编代码实现![image-20220602073406246](./imgs/image-20220602073406246.png)
4. 在syscall.c中修改跳转表，添加外部函数声明![image-20220602073432665](./imgs/image-20220602073432665.png)![image-20220602073447056](./imgs/image-20220602073447056.png)
5. 在sysproc.c实现sys_chpri函数![image-20220602080932272](./imgs/image-20220602080932272.png)
6. 在proc.c实现chpri函数![image-20220602080959136](./imgs/image-20220602080959136.png)
7. 在defs.h添加函数原型![image-20220602081038247](./imgs/image-20220602081038247.png)

## 修改调度器

修改scheduler调度器，每次选择可调度的优先级最高的进程![image-20220602081107276](./imgs/image-20220602081107276.png)

## 验证优先级调度

1. 编写程序，两个优先级不同的进程同时执行，观察其调度情况。![image-20220602081150751](./imgs/image-20220602081150751.png)

   ![image-20220602081219515](./imgs/image-20220602081219515.png)

2. 验证调度的正确性：p2先执行->p2睡眠，p1执行->p2继续执行->p2结束，p1执行